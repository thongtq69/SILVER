{% comment %}
  Structured Data (JSON-LD) for SEO
  Supports Product, Organization, BreadcrumbList schemas
{% endcomment %}

{% if template.name == 'product' %}
  <!-- Product Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": {{ product.title | json }},
    "description": {{ product.description | strip_html | truncate: 5000 | json }},
    "url": "{{ canonical_url }}",
    {% if product.featured_image %}
    "image": [
      "https:{{ product.featured_image | image_url: width: 1200 }}"
    ],
    {% endif %}
    "sku": {{ product.selected_or_first_available_variant.sku | default: product.id | json }},
    "brand": {
      "@type": "Brand",
      "name": {{ product.vendor | json }}
    },
    "offers": {
      "@type": "Offer",
      "url": "{{ canonical_url }}",
      "priceCurrency": "{{ cart.currency.iso_code }}",
      "price": "{{ product.selected_or_first_available_variant.price | money_without_currency | remove: ',' }}",
      {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
      "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
      {% endif %}
      "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
      "seller": {
        "@type": "Organization",
        "name": {{ shop.name | json }}
      }
    }
    {% if product.metafields.reviews.rating.value %}
    ,"aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": {{ product.metafields.reviews.rating.value | json }},
      "reviewCount": {{ product.metafields.reviews.rating_count.value | default: 1 | json }}
    }
    {% endif %}
  }
  </script>
{% endif %}

{% if template.name == 'collection' %}
  <!-- Collection ItemList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": {{ collection.title | json }},
    "description": {{ collection.description | strip_html | json }},
    "url": "{{ canonical_url }}",
    "numberOfItems": {{ collection.products_count }},
    "itemListElement": [
      {% for product in collection.products limit: 10 %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "url": "{{ shop.secure_url }}{{ product.url }}"
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
  </script>
{% endif %}

{% if template.name == 'index' %}
  <!-- Organization Schema (Homepage) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    "url": "{{ shop.secure_url }}",
    {% if settings.logo %}
    "logo": "https:{{ settings.logo | image_url: width: 400 }}",
    {% endif %}
    "description": {{ shop.description | json }},
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "AU"
    },
    {% if settings.social_facebook != blank or settings.social_instagram != blank %}
    "sameAs": [
      {% if settings.social_facebook != blank %}"{{ settings.social_facebook }}"{% endif %}
      {% if settings.social_facebook != blank and settings.social_instagram != blank %},{% endif %}
      {% if settings.social_instagram != blank %}"{{ settings.social_instagram }}"{% endif %}
    ],
    {% endif %}
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "customer service",
      "availableLanguage": "English"
    }
  }
  </script>
  
  <!-- WebSite Schema with SearchAction -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": {{ shop.name | json }},
    "url": "{{ shop.secure_url }}",
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "{{ shop.secure_url }}/search?q={search_term_string}"
      },
      "query-input": "required name=search_term_string"
    }
  }
  </script>
{% endif %}

<!-- BreadcrumbList Schema (All pages) -->
{% unless template.name == 'index' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ shop.secure_url }}"
    }
    {% if template.name == 'collection' %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ collection.title | json }},
      "item": "{{ canonical_url }}"
    }
    {% elsif template.name == 'product' %}
    {% if product.collections.first %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ product.collections.first.title | json }},
      "item": "{{ shop.secure_url }}{{ product.collections.first.url }}"
    }
    {% endif %}
    ,{
      "@type": "ListItem",
      "position": {% if product.collections.first %}3{% else %}2{% endif %},
      "name": {{ product.title | json }},
      "item": "{{ canonical_url }}"
    }
    {% elsif template.name == 'page' %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ page.title | json }},
      "item": "{{ canonical_url }}"
    }
    {% elsif template.name == 'article' %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ blog.title | json }},
      "item": "{{ shop.secure_url }}{{ blog.url }}"
    }
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": {{ article.title | json }},
      "item": "{{ canonical_url }}"
    }
    {% endif %}
  ]
}
</script>
{% endunless %}
